<template>
  <div class="min-h-screen bg-gray-50 py-12">
    <div class="max-w-4xl mx-auto px-4">
      
      <div class="flex items-center justify-between mb-8">
        <h1 class="text-3xl font-extrabold text-gray-900">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
        <RouterLink to="/" class="text-gray-600 hover:text-black underline">
          ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–∞–≥–∞–∑–∏–Ω
        </RouterLink>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        
        <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100 h-fit">
          <h2 class="text-xl font-bold text-gray-900 mb-6 border-b pb-2">üìÇ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h2>
          
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
              <input 
                v-model="newCategory.name" 
                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–µ–¥—ã" 
                class="w-full p-3 border border-gray-300 rounded-lg text-gray-900 bg-white placeholder-gray-400 focus:ring-2 focus:ring-black focus:border-transparent outline-none transition-all" 
              />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Slug (URL)</label>
              <input 
                v-model="newCategory.slug" 
                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: kedy" 
                class="w-full p-3 border border-gray-300 rounded-lg text-gray-900 bg-white placeholder-gray-400 focus:ring-2 focus:ring-black focus:border-transparent outline-none transition-all" 
              />
              <p class="text-xs text-gray-500 mt-1">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤.</p>
            </div>
            
            <button 
              @click="addCategory" 
              class="w-full bg-gray-900 text-white font-bold py-3 px-4 rounded-lg hover:bg-black transition-colors mt-2"
            >
              –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            </button>
          </div>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100">
          <h2 class="text-xl font-bold text-gray-900 mb-6 border-b pb-2">üëü –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
          
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏</label>
              <input 
                v-model="newProduct.name" 
                placeholder="Nike Air Force 1" 
                class="w-full p-3 border border-gray-300 rounded-lg text-gray-900 bg-white placeholder-gray-400 focus:ring-2 focus:ring-black focus:border-transparent outline-none" 
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">–û–ø–∏—Å–∞–Ω–∏–µ</label>
              <textarea 
                v-model="newProduct.description" 
                placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..." 
                rows="3"
                class="w-full p-3 border border-gray-300 rounded-lg text-gray-900 bg-white placeholder-gray-400 focus:ring-2 focus:ring-black focus:border-transparent outline-none"
              ></textarea>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">–¶–µ–Ω–∞ (‚ÇΩ)</label>
                <input 
                  v-model.number="newProduct.price" 
                  type="number" 
                  placeholder="0" 
                  class="w-full p-3 border border-gray-300 rounded-lg text-gray-900 bg-white placeholder-gray-400 focus:ring-2 focus:ring-black focus:border-transparent outline-none" 
                />
              </div>
              
              <div>
                 <label class="block text-sm font-medium text-gray-700 mb-1">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                 <select 
                   v-model="newProduct.category_id" 
                   class="w-full p-3 border border-gray-300 rounded-lg text-gray-900 bg-white focus:ring-2 focus:ring-black focus:border-transparent outline-none"
                 >
                  <option disabled value="">–í—ã–±—Ä–∞—Ç—å...</option>
                  <option v-for="cat in productsStore.categories" :key="cat.id" :value="cat.id">
                    {{ cat.name }}
                  </option>
                </select>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">URL –∫–∞—Ä—Ç–∏–Ω–∫–∏</label>
              <input 
                v-model="newProduct.image_url" 
                placeholder="https://..." 
                class="w-full p-3 border border-gray-300 rounded-lg text-gray-900 bg-white placeholder-gray-400 focus:ring-2 focus:ring-black focus:border-transparent outline-none" 
              />
            </div>
            
            <button 
              @click="addProduct" 
              class="w-full bg-black text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-800 transition-colors shadow-lg mt-4"
            >
              –î–æ–±–∞–≤–∏—Ç—å –∫—Ä–æ—Å—Å–æ–≤–∫–∏
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { useProductsStore } from '@/stores/products'

const productsStore = useProductsStore()

// –î–∞–Ω–Ω—ã–µ –¥–ª—è —Ñ–æ—Ä–º
const newCategory = ref({ name: '', slug: '' })
const newProduct = ref({ 
  name: '', 
  description: '', 
  price: null, // null —á—Ç–æ–±—ã –ø–æ–ª–µ –±—ã–ª–æ –ø—É—Å—Ç—ã–º, –∞ –Ω–µ 0
  category_id: '', 
  image_url: '' 
})

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, 
// —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
onMounted(async () => {
  await productsStore.fetchCategories()
})

// –õ–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
const addCategory = async () => {
  if (!newCategory.value.name || !newCategory.value.slug) {
    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏!')
    return
  }
  
  try {
    await productsStore.createCategory(newCategory.value)
    alert('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞! üéâ')
    newCategory.value = { name: '', slug: '' } // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
  } catch (e) {
    alert('–û—à–∏–±–∫–∞! –í–æ–∑–º–æ–∂–Ω–æ, —Ç–∞–∫–æ–π slug —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.')
  }
}

// –õ–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
const addProduct = async () => {
  // –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
  if (!newProduct.value.name || !newProduct.value.price || !newProduct.value.category_id) {
    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–ù–∞–∑–≤–∞–Ω–∏–µ, –¶–µ–Ω–∞, –ö–∞—Ç–µ–≥–æ—Ä–∏—è)!')
    return
  }

  try {
    await productsStore.createProduct(newProduct.value)
    alert('–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω! üëü')
    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    newProduct.value = { name: '', description: '', price: null, category_id: '', image_url: '' }
  } catch (e) {
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞.')
  }
}
</script>